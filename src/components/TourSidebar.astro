---
/**
 * Reusable sticky sidebar for tour booking CTAs.
 * Used on both destination detail pages and city hub pages.
 */
import type { FeaturedTour } from '../data/destinations'

interface Props {
  tours: FeaturedTour[]
  tourCount?: number
}

const { tours, tourCount } = Astro.props
const heroTour = tours.find(t => t.tier === 'hero')
const budgetTour = tours.find(t => t.tier === 'budget')
const premiumTour = tours.find(t => t.tier === 'premium')
const displayCount = tourCount ?? tours.length
import CdnImage from '../components/CdnImage.astro';
---

<aside class="hidden lg:block lg:w-1/3">
  <div class="sticky top-8 space-y-4">
    <h3 class="text-lg font-bold text-white mb-2">Book a Tour</h3>

    {heroTour && (
      <a href={heroTour.viatorUrl} target="_blank"
        rel="noopener noreferrer nofollow"
        class="group block rounded-lg overflow-hidden bg-white/5 border border-white/10 hover:border-purple-500/50 transition-all duration-300">
        <div class="aspect-video overflow-hidden">
          <CdnImage src={heroTour.image} alt={heroTour.title} width={720} height={480} loading="lazy" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" decoding="async" />
        </div>
        <div class="p-4">
          <span class="text-xs text-yellow-400 font-medium uppercase tracking-wider">Top Pick</span>
          <h4 class="text-white font-semibold group-hover:text-purple-400 transition-colors mt-1 mb-2 text-sm leading-snug">
            {heroTour.title}
          </h4>
          <div class="flex items-center gap-2 text-xs text-gray-400 mb-3">
            <span class="text-yellow-400">★ {heroTour.rating}</span>
            <span>({heroTour.reviews.toLocaleString()})</span>
            {heroTour.duration && <span>· {heroTour.duration}</span>}
          </div>
          <div class="flex items-center justify-between">
            <span class="text-lg font-bold text-white">From {heroTour.price}</span>
            <span class="px-3 py-1.5 rounded-lg bg-purple-600 text-white text-xs font-semibold group-hover:bg-purple-500 transition-colors">
              View Tour →
            </span>
          </div>
        </div>
      </a>
    )}

    {budgetTour && (
      <a href={budgetTour.viatorUrl} target="_blank"
        rel="noopener noreferrer nofollow"
        class="group block rounded-lg p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 transition-all duration-300">
        <span class="text-xs text-emerald-400 font-medium uppercase tracking-wider">Best Value</span>
        <h4 class="text-white font-semibold group-hover:text-purple-400 transition-colors mt-1 mb-2 text-sm leading-snug">
          {budgetTour.title}
        </h4>
        <div class="flex items-center justify-between">
          <div class="text-xs text-gray-400">
            <span class="text-yellow-400">★ {budgetTour.rating}</span> ({budgetTour.reviews.toLocaleString()})
          </div>
          <span class="text-white font-bold">From {budgetTour.price}</span>
        </div>
      </a>
    )}

    {premiumTour && (
      <a href={premiumTour.viatorUrl} target="_blank"
        rel="noopener noreferrer nofollow"
        class="group block rounded-lg p-4 bg-white/5 border border-white/10 hover:border-purple-500/50 transition-all duration-300">
        <span class="text-xs text-purple-400 font-medium uppercase tracking-wider">Premium</span>
        <h4 class="text-white font-semibold group-hover:text-purple-400 transition-colors mt-1 mb-2 text-sm leading-snug">
          {premiumTour.title}
        </h4>
        <div class="flex items-center justify-between">
          <div class="text-xs text-gray-400">
            <span class="text-yellow-400">★ {premiumTour.rating}</span> ({premiumTour.reviews.toLocaleString()})
          </div>
          <span class="text-white font-bold">From {premiumTour.price}</span>
        </div>
      </a>
    )}

    <p class="text-center text-sm text-gray-500 py-2">
      {displayCount} tours available
    </p>
  </div>
</aside>
